#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>

void assign(void);

void assign10(void);
void assign20(void);

void auto_func(void);
void static_func(void);

int c; // 전역 변수 선언

int main(void) {

    // 지역 변수
    
    // main 함수의 지역 변수 a (스택에 저장)
    // assign()의 a와는 전혀 별개이며, 서로 영향을 주지 않음
    int a = 0;

    assign();  // assign 함수 호출 → 새로운 스택 프레임 생성
    printf("main 함수 a: %d\n", a);  // 여전히 0 출력 (값 안 바뀜)

    printf("\n\n"); //-----------------------------------------------------------------------------

    // 블록 안에서 사용하는 지역 변수

    // 함수 내 지역 변수 (스택에 저장됨)
    int a1 = 10, b1 = 20;

    printf("교환 전 a와 b의 값: %d, %d\n", a1, b1);
    { // 블록 시작
        // 이 블록 안에서만 유효한 지역 변수 temp
        int temp;

        temp = a1;
        a1 = b1;
        b1 = temp;
    } // 블록 끝 → 여기서 temp는 메모리에서 사라짐 (스코프 종료)

    printf("교환 후 a와 b의 값: %d, %d\n", a1, b1);

    printf("\n\n"); //-----------------------------------------------------------------------------

    // 전역 변수

    printf("함수 호출 전 c값: %d\n", c);

    assign10(); // 전역 변수 c에 10 저장
    assign20(); // 지역 변수 c를 새로 선언 → 전역 변수 c는 영향 안 받음

    printf("함수 호출 후 c값: %d\n", c); // 여전히 전역 변수 c 사용

    printf("\n\n"); //-----------------------------------------------------------------------------

    // 정적 지역 변수

    int i;

    printf("auto 지역 변수를 사용한 함수\n");
    for (i = 0; i < 3; i++) {
        auto_func(); // 매 호출마다 새로 만들어지는 스택 변수 → 값 누적 (X)
    }

    printf("static 지역 변수를 사용한 함수\n");
    for (i = 0; i < 3; i++) {
        static_func(); // 한 번만 만들어지는 데이터 영역 변수 → 값 누적 (O)
    }

    // auto 변수는 스택에 존재하므로 오버플로우 대상 가능
    // static 변수는 데이터 영역에 있으므로 오버플로우로는 직접 덮을 수 없음
}

//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

void assign(void) {
    // [스택] assign 함수의 지역 변수 a (스택에 저장)
    // main()의 a와는 이름만 같고, 완전히 다른 메모리 공간에 있음
    int a;

    a = 10;  // assign 함수 스택 프레임 내 지역 변수에 값 할당
    printf("assign 함수 a: %d\n", a);  // 10 출력

    // 함수 종료 시 assign의 스택 프레임 소멸 → 변수 a도 사라짐
}

void assign10(void) {

    c = 10;  // 전역 변수 c에 10 대입
}

void assign20(void) {

    int c;   // 전역 변수 c와 같은 이름의 지역 변수 → 완전히 별개
    c = 20;  // 이건 지역 변수 c에 20을 대입한 것 (전역 변수는 untouched)
}

void auto_func(void) {

    auto int a = 0;  // 스택에 저장됨 (일반 지역 변수, auto는 생략 가능)
    a++;             // 매 호출 시 a는 다시 0부터 시작
    printf("%d\n", a);
}

void static_func(void) {

    static int a;    // 데이터 영역에 저장 → 프로그램 종료 전까지 유지됨
    a++;             // 값이 누적됨
    printf("%d\n", a);
}