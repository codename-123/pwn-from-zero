#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>

void swap(int* pa, int* pb);	// 두 변수의 값을 바꾸는 함수 선언

int main(void) {

	// 주소와 포인터의 크기

	// 스택에 변수 3개가 연속적으로 올라감 (대체로 아래 순서대로 정렬됨)
	char ch;       // 1바이트
	int in;        // 4바이트
	double db;     // 8바이트 (정렬 때문에 순서나 패딩 주의)

	// 각 변수의 주소를 포인터에 저장 (이 주소값이 스택 주소다)
	char* pc = &ch;      // hc는 ch의 주소를 가리킴
	int* pi = &in;       // pi는 in의 주소를 가리킴
	double* pd = &db;    // pd는 db의 주소를 가리킴

	// -------------------------------------------
	// [ 주소 크기 확인 ]
	// 변수에 & 붙이면 그 변수의 "메모리 주소값" → 포인터임
	// 시스템 해킹 관점에서는 "주소값의 크기 = 포인터의 크기" 와 같음
	// 64비트 시스템이라면 모두 8바이트여야 정상
	printf("char형 변수의 주소 크기: %d\n", sizeof(&ch));
	printf("int형 변수의 주소 크기: %d\n", sizeof(&in));
	printf("double형 변수의 주소 크기: %d\n", sizeof(&db));

	// -------------------------------------------
	// [ 포인터 변수 자체의 크기 ]
	// hc, pi, pd 전부 포인터이므로 크기는 동일 (64비트면 8바이트)
	// 시스템 해킹 시, 스택에 저장된 포인터들이 전부 같은 크기라는 전제가 중요함
	printf("char * 포인터의 크기: %d\n", sizeof(pc));
	printf("int * 포인터의 크기: %d\n", sizeof(pi));
	printf("double * 포인터의 크기: %d\n", sizeof(pd));

	// -------------------------------------------
	// [ 포인터가 가리키는 변수의 크기 ]
	// *hc는 ch를 의미하고, 그 크기는 1바이트
	// *pi는 in → 4바이트
	// *pd는 db → 8바이트
	// 즉, 포인터로 역참조하면 실제 대상의 크기가 중요해짐
	// 시스템 해킹에선 *(p+1), *(p+2) 접근 시 '한 단위가 얼마나 되는지' 이걸 바탕으로 계산함
	printf("char * 포인터가 가르키는 변수의 크기: %d\n", sizeof(*pc));
	printf("int * 포인터가 가르키는 변수의 크기: %d\n", sizeof(*pi));
	printf("double * 포인터가 가르키는 변수의 크기: %d\n", sizeof(*pd));

	printf("\n\n"); //--------------------------------------------------------------------------------

	// 포인터의 대입 규칙

	int a = 10;         // 변수 a에 10을 저장
	int* p = &a;        // p는 int형 포인터로, a의 주소를 저장
	double* pb;         // pb는 double형 포인터

	pb = p;             // ⚠️ 잘못된 대입: int* → double* (타입 불일치, 컴파일러 경고 or 위험한 동작)

	printf("%lf\n", *pb); // pb가 가리키는 메모리를 double로 해석 → 정의되지 않은 동작 (UB)

	// 포인터는 반드시 "가리키는 대상의 타입"이 같을 때만 대입해야 함
	// 예: int* → int*, double* → double*
	// 타입이 다르면 명시적 캐스팅이 필요하고, 그 자체도 위험할 수 있음

	printf("\n\n"); //--------------------------------------------------------------------------------

	// 포인터가 필요한 이유
	
	// int a = 10
	int b = 20;

	swap(&a, &b);	// a의 메모리 주소, b의 메모리 주소를 각각 매개변수로 전달.
	printf("a: %d, b: %d\n", a, b);

}

void swap(int* pa, int* pb) { // 매개변수로 포인터 선언
	
	int temp;	// 교환을 위한 임시 변수

	temp = *pa; // temp = 10
	*pa = *pb;	// *pa = 20
	*pb = temp; // *pb = 10
}